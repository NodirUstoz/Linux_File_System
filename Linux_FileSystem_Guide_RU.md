# Linux: Файловая система и основы CTF

<div align="center">

### Учебное пособие для студентов

![Linux](https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black)
![Bash](https://img.shields.io/badge/Bash-4EAA25?style=for-the-badge&logo=gnu-bash&logoColor=white)
![CTF](https://img.shields.io/badge/CTF-FF6F00?style=for-the-badge&logo=hackthebox&logoColor=white)

</div>

---

| | |
|---|---|
| **Автор** | Nodir Ustoz |
| **Уровень** | Начальный - Средний |
| **Цель** | Глубокое изучение файловой системы Linux и подготовка к CTF соревнованиям |
| **Время чтения** | ~45 минут |

---

> **Совет:** После изучения этого руководства практикуйтесь на платформе [OverTheWire Bandit](https://overthewire.org/wargames/bandit/)!

---

## Содержание

1. [Введение и основные понятия](#1-введение-и-основные-понятия)
2. [Архитектура файловой системы Linux](#2-архитектура-файловой-системы-linux)
3. [Навигация и основные команды](#3-навигация-и-основные-команды)
4. [Методы поиска файлов](#4-методы-поиска-файлов)
5. [Чтение содержимого файлов](#5-чтение-содержимого-файлов)
6. [Получение помощи — --help, man, info](#6-получение-помощи----help-man-info)
7. [Текстовые редакторы — nano и vim](#7-текстовые-редакторы--nano-и-vim)
8. [Система прав и разрешений](#8-система-прав-и-разрешений)
9. [Важные каталоги и их функции](#9-важные-каталоги-и-их-функции)
10. [Работа с архивами](#10-работа-с-архивами)
11. [Операции с дисками и монтирование](#11-операции-с-дисками-и-монтирование)
12. [Символические ссылки](#12-символические-ссылки)
13. [Практические упражнения](#13-практические-упражнения)
14. [CTF стратегии](#14-ctf-стратегии)

---

## 1. Введение и основные понятия

### 1.1 Что такое Linux?

**Linux** — это ядро операционной системы с открытым исходным кодом, созданное Линусом Торвальдсом в 1991 году. Сегодня Linux широко используется на серверах, суперкомпьютерах, мобильных устройствах (Android) и во многих других областях.

> **Интересный факт:** 100% из 500 самых мощных суперкомпьютеров мира работают на Linux.

### 1.2 Что такое CTF (Capture The Flag)?

**CTF** — это соревнования по кибербезопасности, где участники решают различные задачи и находят секретные строки, называемые "флагами".

**Форматы флагов:**
```
FLAG{это_простой_флаг}
CTF{capture_the_flag}
HTB{hack_the_box_flag}
flag{строчные_буквы}
```

### 1.3 Почему Linux CLI (Command Line Interface)?

| Графический интерфейс (GUI) | Командная строка (CLI) |
|-----------------------------|------------------------|
| Визуальный, легко начать | Быстрый и эффективный |
| Потребляет много ресурсов | Минимальные ресурсы |
| Сложно автоматизировать | Легко автоматизировать с помощью скриптов |
| Ограничен в управлении серверами | Основной инструмент управления серверами |

### 1.4 Терминал и shell

Понимание терминала и оболочки (shell) является основой работы с Linux. Эти два компонента работают вместе, предоставляя мощный интерфейс командной строки.

#### 1.4.1 Что такое терминал?

**Терминал** (также называемый эмулятором терминала) — это текстовое окно интерфейса, которое предоставляет способ взаимодействия с операционной системой через текстовые команды. Это современный эквивалент физических терминалов, которые использовались для подключения к мейнфреймам.

**Ключевые характеристики:**
- Текстовый ввод и вывод
- Интерфейс командной строки (CLI)
- Может запускать несколько оболочек
- Поддерживает цвета, шрифты и настройки
- Предоставляет доступ к системным ресурсам

**Популярные эмуляторы терминала:**
- **GNOME Terminal** — По умолчанию в средах GNOME
- **Konsole** — Терминал KDE
- **Terminal.app** — Терминал macOS по умолчанию
- **Windows Terminal** — Современный терминал Windows
- **Alacritty** — Быстрый, GPU-ускоренный терминал
- **iTerm2** — Продвинутый терминал macOS

**Терминал vs Консоль:**
- **Терминал**: Программа, эмулирующая физический терминал (программное обеспечение)
- **Консоль**: Физическое устройство или системная консоль (аппаратное обеспечение)

#### 1.4.2 Что такое shell?

**Shell** — это программа-интерпретатор командной строки, которая обрабатывает команды и выполняет их. Она действует как интерфейс между пользователем и ядром операционной системы. Оболочка читает команды из терминала, интерпретирует их и выполняет соответствующие программы.

**Функции shell:**
- **Выполнение команд**: Запускает программы и скрипты
- **Интерпретация команд**: Парсит и обрабатывает команды
- **Управление окружением**: Управляет переменными окружения
- **Скриптование**: Позволяет автоматизацию через shell-скрипты
- **Управление задачами**: Управляет фоновыми процессами
- **Перенаправление ввода/вывода**: Обрабатывает каналы и перенаправления

**Как работает shell:**
```
Ввод пользователя → Терминал → Shell → Ядро → Системные вызовы → Аппаратура
         ↑                                                      ↓
         └────────── Вывод ←────────────────────────────────────┘
```

#### 1.4.3 Популярные оболочки

##### Bash (Bourne Again Shell)

**Bash** — наиболее широко используемая оболочка в Linux и оболочка по умолчанию в большинстве дистрибутивов.

**Возможности:**
- История команд с клавишами-стрелками
- Автодополнение команд и имён файлов (Tab)
- Псевдонимы команд (aliases)
- Расширение переменных окружения
- Мощные возможности скриптования
- Управление задачами (фоновые процессы)
- Расширение фигурных скобок (`{1..10}`)
- Подстановка команд (`$(command)`)

**Проверка вашей оболочки:**
```bash
echo $SHELL                    # Путь к текущей оболочке
echo $0                        # Имя оболочки
ps -p $$                       # Информация о процессе
```

**Версия Bash:**
```bash
bash --version
# Вывод: GNU bash, version 5.1.16(1)-release (x86_64-pc-linux-gnu)
```

**Файлы конфигурации Bash:**
- `~/.bashrc` — Конфигурация интерактивной не-логин оболочки
- `~/.bash_profile` — Конфигурация логин оболочки
- `~/.bash_history` — История команд
- `/etc/bash.bashrc` — Системная конфигурация

##### Zsh (Z Shell)

**Zsh** — мощная оболочка с современными возможностями, популярная среди разработчиков.

**Возможности:**
- Продвинутое автодополнение
- Улучшенный globbing (сопоставление шаблонов)
- Система плагинов (фреймворк Oh My Zsh)
- Исправление орфографии
- Поддержка тем
- Общая история команд
- Улучшенная работа с массивами

**Установка:**
```bash
# Debian/Ubuntu
sudo apt install zsh

# CentOS/RHEL
sudo yum install zsh

# macOS
brew install zsh
```

**Сделать Zsh оболочкой по умолчанию:**
```bash
chsh -s $(which zsh)
```

**Популярные фреймворки Zsh:**
- **Oh My Zsh** — Фреймворк сообщества
- **Prezto** — Фреймворк конфигурации
- **Powerlevel10k** — Быстрая тема

##### Fish (Friendly Interactive Shell)

**Fish** разработан для удобства пользователей с подсветкой синтаксиса и авто-предложениями.

**Возможности:**
- Подсветка синтаксиса при вводе
- Автоматические предложения на основе истории
- Веб-конфигурация
- Разумные настройки по умолчанию (не требует конфигурации)
- Улучшенные сообщения об ошибках
- Автодополнение с описаниями

**Установка:**
```bash
# Debian/Ubuntu
sudo apt install fish

# macOS
brew install fish
```

**Конфигурация Fish:**
```bash
fish_config                    # Открывает веб-конфигурацию
```

##### sh (Bourne Shell)

**sh** — оригинальная оболочка Unix, теперь часто символическая ссылка на другую оболочку (например, dash в Debian/Ubuntu).

**Характеристики:**
- Соответствие POSIX
- Минимальные возможности
- Быстрый запуск
- Используется для системных скриптов
- Базовая функциональность

**Примечание:** Многие системы используют `dash` (Debian Almquist Shell) как `/bin/sh` для более быстрого выполнения скриптов.

#### 1.4.4 Типы оболочек: Login vs Non-Login

**Login Shell:**
- Запускается при входе в систему (SSH, консольный вход)
- Читает: `/etc/profile`, `~/.bash_profile` или `~/.profile`
- Полная настройка окружения

**Non-Login Shell:**
- Запускается из графического терминала или команды `bash`
- Читает: `~/.bashrc` или `/etc/bash.bashrc`
- Быстрый запуск

**Проверка типа оболочки:**
```bash
echo $0                        # Показывает имя оболочки
shopt -q login_shell && echo "Login shell" || echo "Non-login shell"
```

#### 1.4.5 Интерактивная vs Неинтерактивная оболочка

**Интерактивная оболочка:**
- Пользователь может вводить команды
- Отображается приглашение
- Читает из терминала
- Пример: Открытие окна терминала

**Неинтерактивная оболочка:**
- Запускает скрипты
- Нет приглашения
- Читает из файла или канала
- Пример: `bash script.sh`

**Проверка интерактивности:**
```bash
[ -t 0 ] && echo "Интерактивная" || echo "Неинтерактивная"
```

#### 1.4.6 Возможности и функции оболочки

**История команд:**
```bash
history                        # Просмотр истории команд
!!                             # Повторить последнюю команду
!n                             # Выполнить команду номер n
!string                        # Выполнить последнюю команду, начинающуюся со string
Ctrl+R                         # Интерактивный поиск в истории
```

**Автодополнение (Tab):**
- **Один Tab**: Дополнить, если уникально
- **Двойной Tab**: Показать все возможности
- Работает для команд, файлов и каталогов

**Псевдонимы (Aliases):**
```bash
alias ll='ls -la'              # Создать псевдоним
alias grep='grep --color=auto' # Цветной grep
unalias ll                     # Удалить псевдоним
alias                          # Список всех псевдонимов
```

**Переменные окружения:**
```bash
export PATH=$PATH:/new/path    # Добавить в PATH
echo $HOME                     # Показать переменную
env                            # Список всех переменных
set                            # Список всех переменных и функций
```

**Перенаправление ввода/вывода:**
```bash
command > file                 # Перенаправить stdout
command >> file                # Добавить в stdout
command < file                 # Перенаправить stdin
command 2> error.log           # Перенаправить stderr
command > file 2>&1            # Перенаправить оба
command | another              # Канал вывода
```

#### 1.4.7 Выбор правильной оболочки

**Для начинающих:**
- **Bash** — По умолчанию, хорошо документирована, широко поддерживается
- **Fish** — Удобная для пользователей, отлично подходит для обучения

**Для разработчиков:**
- **Zsh** — Мощная, расширяемая, современные возможности
- **Bash** — Универсальная, работает везде

**Для системных скриптов:**
- **sh** — Соответствует POSIX, быстрая, переносимая

**Для CTF/Соревнований:**
- **Bash** — Доступна везде, необходимо знать

#### 1.4.8 Практические примеры

**Временное переключение оболочек:**
```bash
bash                           # Переключиться на bash
zsh                            # Переключиться на zsh
fish                           # Переключиться на fish
exit                           # Вернуться к предыдущей оболочке
```

**Запуск команд в разных оболочках:**
```bash
bash -c "echo 'Привет из Bash'"
zsh -c "echo 'Привет из Zsh'"
sh -c "echo 'Привет из sh'"
```

**Shebang в shell-скриптах:**
```bash
#!/bin/bash                    # Использовать bash
#!/bin/sh                      # Использовать sh (переносимо)
#!/usr/bin/env bash            # Использовать bash из PATH
```

#### 1.4.9 Советы по терминалу и оболочке

**Советы по терминалу:**
- Используйте `Ctrl+Shift+T` для открытия новых вкладок (большинство терминалов)
- Используйте `Ctrl+Shift+C` для копирования (большинство терминалов)
- Используйте `Ctrl+Shift+V` для вставки (большинство терминалов)
- Настройте цвета и шрифты для лучшей читаемости
- Используйте мультиплексоры терминала (tmux, screen) для сессий

**Советы по оболочке:**
- Изучите сочетания клавиш (`Ctrl+A`, `Ctrl+E`, `Ctrl+U`, `Ctrl+K`)
- Используйте автодополнение Tab широко
- Создавайте полезные псевдонимы для частых команд
- Держите ваш `.bashrc` или `.zshrc` организованным
- Используйте функции для сложных операций

**Основные сочетания клавиш:**
- `Ctrl+C` — Прервать текущую команду
- `Ctrl+D` — Выйти из оболочки (EOF)
- `Ctrl+L` — Очистить экран
- `Ctrl+A` — Переместиться в начало строки
- `Ctrl+E` — Переместиться в конец строки
- `Ctrl+U` — Удалить до начала строки
- `Ctrl+K` — Удалить до конца строки
- `Ctrl+W` — Удалить предыдущее слово
- `Alt+.` — Вставить последний аргумент предыдущей команды
- `Ctrl+R` — Поиск в истории команд

> **Профессиональный совет:** Понимание терминала и оболочки крайне важно для мастерства в Linux. Проводите время, практикуясь с разными оболочками и настраивая своё окружение. Для CTF соревнований Bash необходима, так как она доступна практически на каждой Linux системе.

---

## 2. Архитектура файловой системы Linux

### 2.1 Философия "Всё есть файл"

В Linux всё представлено как файл:
- Обычные файлы (текст, бинарные)
- Каталоги (directories)
- Устройства (devices) — `/dev/sda`, `/dev/null`
- Процессы — в `/proc/`
- Сетевые сокеты

### 2.2 Иерархия файловой системы (FHS)

```
/                      # Root — начало всех файлов
├── bin/               # Основные команды (ls, cp, mv)
├── boot/              # Файлы загрузки
├── dev/               # Файлы устройств
├── etc/               # Конфигурационные файлы
├── home/              # Каталоги пользователей
│   ├── student/
│   └── admin/
├── lib/               # Библиотеки
├── media/             # Съёмные устройства
├── mnt/               # Временные точки монтирования
├── opt/               # Дополнительные программы
├── proc/              # Информация о процессах (виртуальная)
├── root/              # Домашний каталог root пользователя
├── run/               # Runtime данные
├── sbin/              # Системные команды
├── srv/               # Данные служб
├── sys/               # Информация о ядре (виртуальная)
├── tmp/               # Временные файлы
├── usr/               # Пользовательские программы
│   ├── bin/
│   ├── lib/
│   ├── local/
│   └── share/
└── var/               # Переменные данные
    ├── log/
    ├── www/
    └── backups/
```

### 2.3 Команда tree — визуализация структуры

Команда `tree` показывает структуру каталогов в виде дерева:

```bash
tree                           # Показать текущий каталог
tree -a                        # Включая скрытые файлы
tree -L 2                      # Глубина только 2 уровня
tree -d                        # Только каталоги
tree -f                        # Показать полные пути
tree -h                        # Размеры файлов (human-readable)
tree -p                        # Показать права доступа
tree --dirsfirst               # Каталоги первыми
tree -I "node_modules|.git"    # Исключить паттерны
```

**Примеры использования:**
```bash
# Структура проекта с размерами
tree -L 3 -h --dirsfirst

# Только Python файлы
tree -P "*.py"

# Исключить определённые каталоги
tree -I "__pycache__|*.pyc"

# Сохранить в файл
tree > structure.txt

# С цветами (если поддерживается)
tree -C
```

**Пример вывода:**
```
.
├── src/
│   ├── main.py
│   ├── utils/
│   │   ├── helper.py
│   │   └── config.py
│   └── tests/
│       └── test_main.py
├── docs/
│   └── README.md
├── requirements.txt
└── setup.py

4 directories, 6 files
```

**Установка tree:**
```bash
# Debian/Ubuntu
sudo apt install tree

# CentOS/RHEL
sudo yum install tree

# macOS
brew install tree
```

### 2.4 Типы файлов

В Linux существует 7 типов файлов:

| Символ | Тип | Описание |
|--------|-----|----------|
| `-` | Обычный файл | Текст, бинарные, изображения и т.д. |
| `d` | Каталог | Содержит другие файлы |
| `l` | Символическая ссылка | Указатель на другой файл |
| `c` | Символьное устройство | Терминалы, клавиатура |
| `b` | Блочное устройство | Диски, USB |
| `p` | Named pipe (FIFO) | Для связи процессов |
| `s` | Сокет | Сетевая связь |

### 2.5 Концепция Inode

**Inode** — это структура данных, хранящая метаданные файла.

Inode содержит:
- Тип файла и права
- Владелец (owner) и группа (group)
- Размер файла
- Временные метки (timestamps)
- Указатели на блоки данных

```bash
# Посмотреть номера inode
ls -li

# Информация о конкретном inode
stat file.txt
```

---

## 3. Навигация и основные команды

### 3.1 pwd — print working directory

Показывает текущий каталог:

```bash
pwd
# Результат: /home/student
```

### 3.2 cd — change directory

Перемещение между каталогами:

```bash
cd /home           # Абсолютный путь
cd katalog         # В папку в текущем каталоге
cd ..              # На уровень выше (parent directory)
cd ../..           # На два уровня выше
cd ~               # В домашний каталог
cd -               # В предыдущий каталог
cd                 # В домашний каталог (как cd ~)
```

### 3.3 ls — list directory contents

Показ содержимого каталога:

```bash
ls                 # Простой список
ls -l              # Подробно (long format)
ls -a              # Все файлы (включая скрытые)
ls -la             # Подробно + все (САМЫЙ ИСПОЛЬЗУЕМЫЙ)
ls -lh             # Human-readable размеры (KB, MB, GB)
ls -lt             # Сортировка по времени
ls -lS             # Сортировка по размеру
ls -lR             # Рекурсивно (включая подкаталоги)
ls -li             # С номерами inode
```

### 3.4 whoami и id

Информация о пользователе:

```bash
whoami             # Имя текущего пользователя
# Результат: student

id                 # Полная идентификация
# Результат: uid=1000(student) gid=1000(student) groups=1000(student),27(sudo)
```

### 3.5 uname — system information

```bash
uname -a           # Вся системная информация
uname -r           # Версия ядра
uname -m           # Архитектура (x86_64)
uname -n           # Hostname
```

---

## 4. Методы поиска файлов

### 4.1 find — мощный инструмент поиска

`find` — самая мощная команда поиска в Linux.

**Базовый синтаксис:**
```bash
find [где] [условия] [действие]
```

#### Поиск по имени:

```bash
find / -name "flag.txt"                    # Точное имя
find / -name "*.txt"                       # По расширению
find / -name "flag*"                       # Начинается с flag
find / -name "*secret*"                    # Содержит secret
find / -iname "FLAG.txt"                   # Без учёта регистра
```

#### Поиск по типу:

```bash
find / -type f                             # Только файлы (file)
find / -type d                             # Только каталоги (directory)
find / -type l                             # Только символические ссылки (link)
```

#### Поиск по размеру:

```bash
find / -size +1M                           # Больше 1 MB
find / -size -100c                         # Меньше 100 байт (c=bytes)
find / -size +1k -size -10k                # Между 1KB и 10KB
```

#### Поиск по времени:

```bash
find / -mtime -1                           # Изменён за последние 24 часа
find / -mtime +7                           # Изменён более 7 дней назад
find / -mmin -30                           # Изменён за последние 30 минут
find / -atime -1                           # Открыт за последние 24 часа
find / -newer reference.txt                # После reference файла
```

#### Поиск по правам:

```bash
find / -perm 644                           # Точно 644 права
find / -perm -4000                         # Установлен SUID bit
find / -perm -2000                         # Установлен SGID bit
find / -readable                           # Можно читать
find / -writable                           # Можно писать
find / -executable                         # Можно выполнять
```

#### Выполнение действий с find:

```bash
find / -name "*.txt" -exec cat {} \;       # Прочитать каждый файл
find / -name "*.log" -exec rm {} \;        # Удалить каждый файл
find / -name "flag*" -exec ls -la {} \;    # Показать подробно
```

#### Скрытие ошибок:

```bash
find / -name "flag*" 2>/dev/null           # Скрыть сообщения об ошибках
```

### 4.2 locate — быстрый поиск

`locate` ищет в базе данных, поэтому быстрее `find`:

```bash
locate flag                                # Искать слово flag
locate -i flag                             # Без учёта регистра
locate "*.txt"                             # С паттерном
```

### 4.3 which, whereis, type

Поиск расположения команды:

```bash
which python                               # Путь к executable
whereis python                             # Binary, source, man страницы
type ls                                    # Тип команды
```

### 4.4 Globbing (wildcard patterns)

Возможность pattern matching в shell:

| Паттерн | Значение | Пример |
|---------|----------|--------|
| `*` | Любые символы | `*.txt` — все txt файлы |
| `?` | Один символ | `file?.txt` — file1.txt, fileA.txt |
| `[abc]` | a, b или c | `file[123].txt` |
| `[a-z]` | от a до z | `file[a-z].txt` |
| `[!abc]` | кроме a, b, c | `file[!0-9].txt` |
| `{a,b}` | a или b | `file.{txt,md}` |

---

## 5. Чтение содержимого файлов

### 5.1 cat — concatenate

Полный вывод содержимого файла:

```bash
cat file.txt                               # Прочитать файл
cat -n file.txt                            # С номерами строк
cat -A file.txt                            # Показать спецсимволы
cat file1.txt file2.txt                    # Объединить два файла
cat file1.txt file2.txt > combined.txt     # Сохранить объединение
```

### 5.2 less и more — постраничный просмотр

Для чтения больших файлов:

```bash
less file.txt                              # Современный просмотрщик
more file.txt                              # Простой просмотрщик
```

**Навигация в less:**
- `Space` или `f` — следующая страница
- `b` — предыдущая страница
- `g` — в начало файла
- `G` — в конец файла
- `/pattern` — поиск
- `n` — следующий результат
- `q` — выход

### 5.3 head и tail

Чтение начала и конца файла:

```bash
head file.txt                              # Первые 10 строк
head -n 5 file.txt                         # Первые 5 строк
head -c 100 file.txt                       # Первые 100 байт

tail file.txt                              # Последние 10 строк
tail -n 20 file.txt                        # Последние 20 строк
tail -f logfile.log                        # Real-time мониторинг
```

### 5.4 strings — текст из бинарных файлов

Извлечение читаемого текста из бинарных файлов:

```bash
strings binary_file                        # Все тексты
strings -n 10 binary_file                  # Строки 10+ символов
strings binary_file | grep flag            # Поиск flag
strings binary_file | grep -E "[A-Z]{3,}\{.*\}"   # Формат флага
```

> **Важно для CTF!** Многие флаги скрыты внутри бинарных файлов.

### 5.5 file — определение типа файла

```bash
file mystery                               # Определить тип файла
file *                                     # Проверить все файлы
file -i file.txt                           # MIME type
```

### 5.6 xxd и hexdump — hex просмотр

Просмотр файла в hex формате:

```bash
xxd file.bin                               # Hex dump
xxd -l 100 file.bin                        # Только 100 байт
xxd -r hex.txt > binary                    # Из hex в binary

hexdump -C file.bin                        # Canonical format
```

---

## 6. Получение помощи — --help, man, info

> **Важно для CTF:** Понимание любой команды начинается с изучения её документации. Многие CTF-решения скрыты в малоизвестных флагах или опциях!

### 6.1 Флаг --help

Практически все команды Linux поддерживают флаги `--help` или `-h`:

```bash
# Базовый синтаксис
команда --help
команда -h

# Примеры
ls --help                                  # Краткая справка по ls
grep --help                                # Все опции grep
find --help                                # Синтаксис find
chmod --help                               # Опции chmod
cat --help                                 # Информация о cat
tar --help                                 # Опции архиватора
```

**Структура вывода --help:**

```
Usage: ls [OPTION]... [FILE]...        ← Синтаксис
List information about the FILEs       ← Описание

Mandatory arguments to long options... ← Примечание

  -a, --all             do not ignore entries starting with .
  │    │                └── Описание
  │    └── Длинный формат (--all)
  └── Короткий формат (-a)

  -l                    use a long listing format
  -h, --human-readable  with -l, print sizes like 1K 234M 2G
  -R, --recursive       list subdirectories recursively
  -S                    sort by file size, largest first
  -t                    sort by time, newest first
  -r, --reverse         reverse order while sorting

Exit status:           ← Коды возврата
 0  if OK,
 1  if minor problems,
 2  if serious trouble.
```

**Полезные приёмы с --help:**

```bash
# Вывод справки с постраничным просмотром
ls --help | less

# Поиск конкретной опции
grep --help | grep -i "recursive"

# Подсчёт доступных опций
ls --help | grep -E "^\s+-" | wc -l
```

### 6.2 man (manual) страницы

`man` — наиболее полная и подробная документация:

```bash
# Базовый синтаксис
man команда

# Примеры
man ls                                     # Полная документация ls
man grep                                   # Manual grep
man find                                   # Подробное описание find
man chmod                                  # Всё о chmod
man bash                                   # Документация Bash (очень объёмная!)
```

**Навигация в man:**

| Клавиша | Действие |
|---------|----------|
| `Space` / `PgDn` | Следующая страница |
| `b` / `PgUp` | Предыдущая страница |
| `Enter` / `↓` | На строку вниз |
| `k` / `↑` | На строку вверх |
| `/pattern` | Поиск вперёд |
| `?pattern` | Поиск назад |
| `n` | Следующий результат |
| `N` | Предыдущий результат |
| `g` | В начало документа |
| `G` | В конец документа |
| `q` | Выход |
| `h` | Справка по man |

**Секции (разделы) man:**

```bash
# man-страницы разделены на 9 секций
man 1 passwd                               # Команда passwd (user commands)
man 5 passwd                               # Формат файла /etc/passwd (file formats)

# Секции:
# 1 - Пользовательские команды (User commands)
# 2 - Системные вызовы (System calls)
# 3 - Библиотечные функции (Library functions)
# 4 - Специальные файлы (Special files, /dev)
# 5 - Форматы файлов (File formats, config)
# 6 - Игры (Games)
# 7 - Разное (Miscellaneous)
# 8 - Команды администрирования (System admin commands)
# 9 - Подпрограммы ядра (Kernel routines)

# Поиск во всех секциях
man -a passwd                              # Все man-страницы passwd
man -k password                            # Поиск по ключевому слову
man -f passwd                              # Краткое описание (whatis)
```

**Структура man-страницы:**

```
NAME         - Название и краткое описание
SYNOPSIS     - Синтаксис (как использовать)
DESCRIPTION  - Подробное описание
OPTIONS      - Список всех опций
EXAMPLES     - Примеры использования
FILES        - Связанные файлы
SEE ALSO     - Связанные команды
BUGS         - Известные ошибки
AUTHOR       - Автор
```

**Полезные приёмы с man:**

```bash
# Поиск примеров в man
man grep | grep -A5 "EXAMPLE"

# Экспорт man в текстовый файл
man ls > ls_manual.txt
man grep | col -b > grep_manual.txt       # Без форматирования

# Поиск расположения man-страницы
man -w ls                                  # /usr/share/man/man1/ls.1.gz

# Чтение сжатой man-страницы
zcat /usr/share/man/man1/ls.1.gz
```

### 6.3 info страницы

Для некоторых команд `info` предоставляет ещё более подробную документацию:

```bash
info coreutils                             # О GNU core utilities
info grep                                  # Подробная документация grep
info find                                  # Детальное описание find
info bash                                  # Полная документация Bash
```

**Навигация в info:**

| Клавиша | Действие |
|---------|----------|
| `n` | Следующий узел (node) |
| `p` | Предыдущий узел |
| `u` | На уровень выше |
| `Enter` | Перейти по ссылке |
| `l` | Вернуться к последнему узлу |
| `Space` | Следующая страница |
| `Del` | Предыдущая страница |
| `/` | Поиск |
| `q` | Выход |

### 6.4 Дополнительные способы получения помощи

```bash
# whatis — краткое описание
whatis ls                                  # ls(1) - list directory contents
whatis grep                                # grep(1) - print lines matching a pattern

# apropos — поиск по ключевому слову
apropos "copy file"                        # Команды для копирования файлов
apropos permission                         # Связанные с правами доступа
apropos search                             # Команды поиска

# type — тип команды
type ls                                    # ls is aliased to 'ls --color=auto'
type cd                                    # cd is a shell builtin
type grep                                  # grep is /usr/bin/grep

# which — расположение исполняемого файла
which python                               # /usr/bin/python
which grep                                 # /usr/bin/grep

# whereis — расположение бинарника, man и исходников
whereis ls                                 # ls: /usr/bin/ls /usr/share/man/man1/ls.1.gz

# command -v — проверка наличия команды
command -v git && echo "Git установлен"
```

### 6.5 Стратегии получения помощи

**1. Порядок знакомства с новой командой:**

```bash
# Шаг 1: Краткая справка
command --help | head -30

# Шаг 2: Описание через whatis
whatis command

# Шаг 3: Чтение manual
man command

# Шаг 4: Поиск примеров
man command | grep -A5 "EXAMPLE"
```

**2. Полезно для CTF:**

```bash
# Просмотр всех флагов команды
grep --help | grep -E "^\s+-"

# Только короткие опции
ls --help 2>&1 | grep -oE "\s-[a-zA-Z]" | sort -u

# Извлечение секции OPTIONS из man
man grep | sed -n '/^OPTIONS/,/^[A-Z]/p'

# Информация о конкретном флаге
man find | grep -A3 "\-perm"
```

**3. Оффлайн-справка:**

```bash
# Сохранение man-страниц
man ls > ls_manual.txt
man grep | col -b > grep_manual.txt       # Без форматирования

# Поиск всех man-страниц
man -w ls                                  # /usr/share/man/man1/ls.1.gz
zcat /usr/share/man/man1/ls.1.gz          # Чтение man-файла
```

> **Совет:** Встретив незнакомую команду в CTF, сразу изучите `--help` и `man`. Часто решение скрыто в специфическом флаге!

---

## 7. Текстовые редакторы — nano и vim

> **Важно для CTF:** На многих серверах доступны только терминальные редакторы. Знание `nano` и `vim` необходимо для работы с CTF и реальными серверами!

### 7.1 nano — простой редактор

`nano` — наиболее дружелюбный терминальный редактор для начинающих.

#### 7.1.1 Запуск nano

```bash
nano                                       # Открыть пустой файл
nano file.txt                              # Открыть существующий/новый файл
nano +10 file.txt                          # Открыть на строке 10
nano +10,5 file.txt                        # Строка 10, столбец 5
nano -l file.txt                           # С номерами строк
nano -m file.txt                           # С поддержкой мыши
nano -i file.txt                           # С автоотступами
nano -E file.txt                           # Tab → пробелы
nano -c file.txt                           # Показывать позицию курсора
nano -w file.txt                           # Не переносить длинные строки
```

#### 7.1.2 Основные команды nano

**В nano `^` означает Ctrl, `M-` означает Alt**

| Комбинация | Действие |
|------------|----------|
| `^G` (Ctrl+G) | Показать справку |
| `^X` (Ctrl+X) | Выход (с запросом сохранения) |
| `^O` (Ctrl+O) | Сохранить (WriteOut) |
| `^R` (Ctrl+R) | Вставить файл (Read file) |
| `^W` (Ctrl+W) | Поиск (Where is) |
| `^\` (Ctrl+\) | Поиск и замена |
| `^K` (Ctrl+K) | Вырезать строку (Cut) |
| `^U` (Ctrl+U) | Вставить (Paste/Uncut) |
| `^J` (Ctrl+J) | Выровнять абзац |
| `^C` (Ctrl+C) | Позиция курсора |
| `^_` (Ctrl+_) | Перейти к строке/столбцу |
| `^T` (Ctrl+T) | Проверка орфографии / Выполнение |

#### 7.1.3 Навигация в nano

| Комбинация | Действие |
|------------|----------|
| `^A` | В начало строки |
| `^E` | В конец строки |
| `^Y` | Предыдущая страница (Page Up) |
| `^V` | Следующая страница (Page Down) |
| `M-\` (Alt+\) | В начало файла |
| `M-/` (Alt+/) | В конец файла |
| `^Space` | На слово вперёд |
| `M-Space` | На слово назад |
| `^↑` | К предыдущему блоку |
| `^↓` | К следующему блоку |

#### 7.1.4 Редактирование в nano

| Комбинация | Действие |
|------------|----------|
| `^K` | Вырезать строку |
| `^U` | Вставить вырезанное |
| `M-6` (Alt+6) | Копировать строку |
| `^6` (Ctrl+6) | Начать выделение (Mark) |
| `M-A` (Alt+A) | Начать выделение |
| `^D` | Удалить символ (Delete) |
| `^H` | Удалить назад (Backspace) |
| `M-Del` | Удалить слово |
| `M-T` | Вырезать до конца строки |
| `M-U` | Отменить (Undo) |
| `M-E` | Повторить (Redo) |

#### 7.1.5 Поиск и замена в nano

```bash
# Поиск (Ctrl+W)
^W → введите шаблон → Enter

# Опции поиска (внутри Ctrl+W):
M-C    Переключить чувствительность к регистру
M-R    Включить регулярные выражения
M-B    Искать назад
^R     Искать в файле
^W     Следующий результат

# Замена (Ctrl+\)
^\ → искомое → Enter → замена → Enter
Y      Заменить одно вхождение
A      Заменить все
N      Пропустить
^C     Отмена
```

#### 7.1.6 Конфигурация nano

```bash
# ~/.nanorc или /etc/nanorc
set linenumbers                            # Номера строк
set autoindent                             # Автоотступы
set tabsize 4                              # Размер табуляции
set tabstospaces                           # Tab → пробелы
set mouse                                  # Поддержка мыши
set smooth                                 # Плавная прокрутка
set constantshow                           # Позиция курсора
set backup                                 # Создавать резервные копии
set nohelp                                 # Скрыть подсказки внизу

# Подсветка синтаксиса
include "/usr/share/nano/*.nanorc"
include "/usr/share/nano/python.nanorc"
include "/usr/share/nano/sh.nanorc"
```

---

### 7.2 vim — мощный редактор

`vim` (Vi IMproved) — профессиональный редактор, сложный в освоении, но чрезвычайно мощный.

#### 7.2.1 Режимы vim

**vim работает в 4 основных режимах:**

```
┌─────────────────────────────────────────────────────────────┐
│                      NORMAL MODE                             │
│                    (режим по умолчанию)                      │
│                                                              │
│    ┌──────────┐    ┌──────────┐    ┌──────────┐             │
│    │    i     │    │    v     │    │    :     │             │
│    │    I     │    │    V     │    │          │             │
│    │    a     │    │   ^V     │    │          │             │
│    │    A     │    │          │    │          │             │
│    │    o     │    │          │    │          │             │
│    │    O     │    │          │    │          │             │
│    ▼          │    ▼          │    ▼          │             │
│ ┌──────────┐  │ ┌──────────┐  │ ┌──────────┐  │             │
│ │  INSERT  │  │ │  VISUAL  │  │ │ COMMAND  │  │             │
│ │   MODE   │  │ │   MODE   │  │ │   MODE   │  │             │
│ └──────────┘  │ └──────────┘  │ └──────────┘  │             │
│    │          │    │          │    │          │             │
│    │ Esc      │    │ Esc      │    │ Enter    │             │
│    └──────────┼────┴──────────┼────┴──────────┘             │
│               │               │                              │
│               └───────────────┘                              │
│                    ▲                                         │
│                    │                                         │
│              Возврат в Normal                                │
└─────────────────────────────────────────────────────────────┘
```

| Режим | Вход | Выход | Назначение |
|-------|------|-------|------------|
| **Normal** | Esc | - | Навигация, команды |
| **Insert** | i, I, a, A, o, O | Esc | Ввод текста |
| **Visual** | v, V, Ctrl+v | Esc | Выделение текста |
| **Command** | : | Enter/Esc | Ex-команды |

#### 7.2.2 Запуск vim

```bash
vim                                        # Пустой файл
vim file.txt                               # Открыть файл
vim +10 file.txt                           # Перейти к строке 10
vim +/pattern file.txt                     # К месту совпадения
vim -O file1 file2                         # Вертикальное разделение
vim -o file1 file2                         # Горизонтальное разделение
vim -p file1 file2                         # Вкладки
vim -R file.txt                            # Только чтение (readonly)
vim -d file1 file2                         # Режим сравнения (diff)
vim -c "set number" file.txt               # С командой
vim +$ file.txt                            # В конец файла
```

#### 7.2.3 Команды Normal mode

**Навигация:**

| Команда | Действие |
|---------|----------|
| `h` `j` `k` `l` | ← ↓ ↑ → (или стрелки) |
| `w` | К началу следующего слова |
| `W` | К началу следующего СЛОВА (после пробела) |
| `b` | К началу предыдущего слова |
| `B` | К началу предыдущего СЛОВА |
| `e` | К концу слова |
| `E` | К концу СЛОВА |
| `0` | В начало строки |
| `^` | К первому непробельному символу |
| `$` | В конец строки |
| `gg` | В начало файла |
| `G` | В конец файла |
| `10G` | К строке 10 |
| `:10` | К строке 10 |
| `{` | К началу абзаца |
| `}` | К концу абзаца |
| `%` | К парной скобке |
| `H` | К верху экрана (High) |
| `M` | К середине экрана (Middle) |
| `L` | К низу экрана (Low) |
| `Ctrl+f` | Страница вниз (Forward) |
| `Ctrl+b` | Страница вверх (Back) |
| `Ctrl+d` | Полстраницы вниз |
| `Ctrl+u` | Полстраницы вверх |
| `zz` | Центрировать текущую строку |
| `zt` | Текущую строку наверх |
| `zb` | Текущую строку вниз |

**Редактирование (в Normal mode):**

| Команда | Действие |
|---------|----------|
| `x` | Удалить символ |
| `X` | Удалить предыдущий символ |
| `dd` | Удалить строку |
| `dw` | Удалить слово |
| `d$` или `D` | Удалить до конца строки |
| `d0` | Удалить до начала строки |
| `dG` | Удалить до конца файла |
| `dgg` | Удалить до начала файла |
| `yy` | Копировать строку (yank) |
| `yw` | Копировать слово |
| `y$` | Копировать до конца строки |
| `p` | Вставить после курсора |
| `P` | Вставить перед курсором |
| `r` | Заменить один символ |
| `R` | Режим замены (overwrite) |
| `cc` | Удалить строку и войти в insert mode |
| `cw` | Удалить слово и войти в insert mode |
| `c$` или `C` | Удалить до конца строки и insert mode |
| `~` | Сменить регистр (a↔A) |
| `u` | Отменить (Undo) |
| `Ctrl+r` | Повторить (Redo) |
| `.` | Повторить последнюю команду |
| `J` | Объединить строки |
| `>>` | Отступ вправо |
| `<<` | Отступ влево |

**Вход в Insert mode:**

| Команда | Действие |
|---------|----------|
| `i` | Вставка перед курсором |
| `I` | Вставка в начале строки |
| `a` | Вставка после курсора (append) |
| `A` | Вставка в конце строки |
| `o` | Новая строка ниже и insert mode |
| `O` | Новая строка выше и insert mode |
| `s` | Удалить символ и insert mode |
| `S` | Удалить строку и insert mode |

#### 7.2.4 Visual mode

```bash
v                                          # Посимвольное выделение
V                                          # Построчное выделение
Ctrl+v                                     # Блочное выделение (столбцы)

# В Visual mode:
d                                          # Удалить выделенное
y                                          # Копировать выделенное
c                                          # Удалить и войти в insert mode
>                                          # Отступ вправо
<                                          # Отступ влево
~                                          # Сменить регистр
u                                          # В нижний регистр
U                                          # В верхний регистр
```

#### 7.2.5 Command mode (:)

**Сохранение и выход:**

```bash
:w                                         # Сохранить
:w filename                                # Сохранить как
:w!                                        # Принудительное сохранение
:q                                         # Выход
:q!                                        # Выход без сохранения
:wq                                        # Сохранить и выйти
:wq!                                       # Принудительно сохранить и выйти
:x                                         # Аналог :wq
ZZ                                         # Аналог :wq (в Normal mode)
ZQ                                         # Аналог :q! (в Normal mode)
:e filename                                # Открыть другой файл
:e!                                        # Перезагрузить файл
```

**Поиск и замена:**

```bash
/pattern                                   # Поиск вперёд
?pattern                                   # Поиск назад
n                                          # Следующее совпадение
N                                          # Предыдущее совпадение
*                                          # Искать слово под курсором вперёд
#                                          # Искать слово под курсором назад

# Замена
:s/old/new/                                # Первое вхождение в строке
:s/old/new/g                               # Все вхождения в строке
:%s/old/new/g                              # Все вхождения в файле
:%s/old/new/gc                             # С подтверждением
:5,10s/old/new/g                           # В строках 5-10
:'<,'>s/old/new/g                          # В выделенном тексте

# Флаги:
# g - global (все вхождения)
# c - confirm (подтверждение)
# i - case insensitive
# I - case sensitive
```

**Работа с файлами:**

```bash
:split                                     # Горизонтальное разделение
:vsplit                                    # Вертикальное разделение
:sp filename                               # Split с файлом
:vsp filename                              # Vertical split с файлом
Ctrl+w w                                   # Переключение между окнами
Ctrl+w h/j/k/l                             # Переход в направлении
Ctrl+w c                                   # Закрыть окно
Ctrl+w o                                   # Закрыть другие окна
:tabnew filename                           # Новая вкладка
gt                                         # Следующая вкладка
gT                                         # Предыдущая вкладка
:tabc                                      # Закрыть вкладку
```

**Настройки:**

```bash
:set number                                # Номера строк
:set nonumber                              # Скрыть номера
:set nu!                                   # Переключить
:set relativenumber                        # Относительные номера
:set hlsearch                              # Подсветка поиска
:set nohlsearch                            # Отключить подсветку
:noh                                       # Убрать текущую подсветку
:set ignorecase                            # Без учёта регистра
:set smartcase                             # Умный регистр
:set autoindent                            # Автоотступы
:set tabstop=4                             # Размер табуляции
:set expandtab                             # Tab → пробелы
:set syntax=python                         # Синтаксис
:syntax on                                 # Подсветка синтаксиса
:set paste                                 # Режим вставки (сохранение формата)
:set nopaste                               # Отключить режим вставки
```

#### 7.2.6 Мощные комбинации vim

**Оператор + движение:**

```bash
d + движение                               # Удалить
y + движение                               # Копировать
c + движение                               # Изменить (удалить + insert)
> + движение                               # Отступ
< + движение                               # Убрать отступ
gU + движение                              # В верхний регистр
gu + движение                              # В нижний регистр

# Примеры:
d2w                                        # Удалить 2 слова
y3j                                        # Копировать 3 строки
c$                                         # Изменить до конца строки
>3j                                        # Отступ 3 строк
gUw                                        # Слово в верхний регистр
```

**Текстовые объекты:**

```bash
# i = inner (внутри), a = around (включая)
diw                                        # Удалить слово
daw                                        # Удалить слово с пробелами
di"                                        # Удалить внутри "..."
da"                                        # Удалить "..." целиком
di(                                        # Удалить внутри (...)
da(                                        # Удалить (...) целиком
di{                                        # Удалить внутри {...}
di[                                        # Удалить внутри [...]
dit                                        # Удалить внутри HTML-тега
dat                                        # Удалить HTML-тег целиком
dip                                        # Удалить абзац
dap                                        # Удалить абзац с пустыми строками

# Работает с y, c:
yiw                                        # Копировать слово
ci"                                        # Изменить содержимое "..."
ca{                                        # Изменить {...} целиком
```

**Макросы:**

```bash
qa                                         # Начать запись в регистр 'a'
# ... последовательность команд ...
q                                          # Остановить запись
@a                                         # Выполнить макрос 'a'
@@                                         # Повторить последний макрос
10@a                                       # Выполнить макрос 'a' 10 раз
```

#### 7.2.7 Конфигурация vim (~/.vimrc)

```vim
" Основные настройки
set number                                 " Номера строк
set relativenumber                         " Относительные номера
set cursorline                             " Подсветка текущей строки
set showmatch                              " Показывать парные скобки
set hlsearch                               " Подсветка поиска
set incsearch                              " Инкрементный поиск
set ignorecase                             " Без учёта регистра
set smartcase                              " Умный регистр

" Отступы
set tabstop=4                              " Tab = 4 пробела
set shiftwidth=4                           " Отступ = 4 пробела
set expandtab                              " Tab → пробелы
set autoindent                             " Автоотступы
set smartindent                            " Умные отступы

" Интерфейс
syntax on                                  " Подсветка синтаксиса
set background=dark                        " Тёмная тема
set wildmenu                               " Автодополнение команд
set laststatus=2                           " Строка состояния
set ruler                                  " Позиция курсора
set scrolloff=5                            " Отступ прокрутки

" Горячие клавиши
let mapleader = ","                        " Клавиша Leader
nnoremap <leader>w :w<CR>                  " ,w = сохранить
nnoremap <leader>q :q<CR>                  " ,q = выйти
nnoremap <C-s> :w<CR>                      " Ctrl+s = сохранить
inoremap jj <Esc>                          " jj = Escape
```

#### 7.2.8 Сравнение vim vs nano

| Характеристика | nano | vim |
|----------------|------|-----|
| Освоение | Легко | Сложно |
| Функциональность | Базовая | Очень мощная |
| Скорость работы | Средняя | Высокая |
| Доступность | Почти везде | Везде |
| Поддержка мыши | Есть | Ограниченная |
| Макросы | Нет | Да |
| Плагины | Нет | Множество |
| Большие файлы | Медленно | Быстро |

> **Совет:** Для начинающих — `nano`, для профессионалов — `vim`. В CTF полезно знать оба редактора!

---

## 8. Система прав и разрешений

### 8.1 Матрица прав

В Linux каждый файл имеет три типа прав для трёх категорий:

```
         Owner    Group    Others
         -----    -----    ------
Read     r (4)    r (4)    r (4)
Write    w (2)    w (2)    w (2)
Execute  x (1)    x (1)    x (1)
```

### 8.2 Чтение прав

```bash
ls -la file.txt
# -rw-r--r-- 1 student group 1234 Jan 10 10:00 file.txt
#  │││ │││ │││
#  │││ │││ └┴┴── Others: r-- (только чтение)
#  │││ └┴┴────── Group: r-- (только чтение)
#  └┴┴────────── Owner: rw- (чтение и запись)
```

### 8.3 Двоичная (binary) система счисления — основа chmod

> 💡 **Почему это важно?** Права доступа в Linux основаны на двоичной системе счисления. Без понимания этого запоминание кодов chmod становится сложным и нелогичным.

#### 8.3.1 Что такое двоичная система счисления?

В повседневной жизни мы используем **десятичную (decimal)** систему счисления — она состоит из 10 цифр: `0, 1, 2, 3, 4, 5, 6, 7, 8, 9`.

**Двоичная (binary)** система счисления состоит только из **2 цифр**: `0` и `1`.

Компьютеры работают в двоичной системе, потому что электрический сигнал имеет только два состояния:
- ⚡ **Есть ток** = `1` (ON, true, да)
- 💤 **Нет тока** = `0` (OFF, false, нет)

#### 8.3.2 Преобразование из десятичной в двоичную

**Значения позиций (справа налево):**

```
Позиция:      7      6      5      4      3      2      1      0
            ─────  ─────  ─────  ─────  ─────  ─────  ─────  ─────
Степень     2⁷     2⁶     2⁵     2⁴     2³     2²     2¹     2⁰
двойки:     128    64     32     16     8      4      2      1
```

**Числа от 0 до 10 в двоичном представлении:**

| Десятичное | Двоичное | Расчёт | Объяснение |
|------------|----------|--------|------------|
| **0** | `0000` | 0 | Ничего нет |
| **1** | `0001` | 2⁰ = 1 | Только позиция 1 |
| **2** | `0010` | 2¹ = 2 | Только позиция 2 |
| **3** | `0011` | 2¹ + 2⁰ = 2+1 | Позиции 2 и 1 |
| **4** | `0100` | 2² = 4 | Только позиция 4 |
| **5** | `0101` | 2² + 2⁰ = 4+1 | Позиции 4 и 1 |
| **6** | `0110` | 2² + 2¹ = 4+2 | Позиции 4 и 2 |
| **7** | `0111` | 2² + 2¹ + 2⁰ = 4+2+1 | Позиции 4, 2 и 1 |
| **8** | `1000` | 2³ = 8 | Только позиция 8 |
| **9** | `1001` | 2³ + 2⁰ = 8+1 | Позиции 8 и 1 |
| **10** | `1010` | 2³ + 2¹ = 8+2 | Позиции 8 и 2 |

> 🎯 **Запомните:** Каждая позиция удваивается: 1 → 2 → 4 → 8 → 16 → 32...

#### 8.3.3 Преобразование из двоичной в десятичную

**Алгоритм:** Сложите значения всех позиций, где стоит `1`.

**Пример:** Преобразование `1011` в десятичное

```
Позиция:       3      2      1      0
              ───    ───    ───    ───
Значение:      8      4      2      1
              ───    ───    ───    ───
Цифра:         1      0      1      1
              ───    ───    ───    ───
Расчёт:       8×1  + 4×0  + 2×1  + 1×1  = 8 + 0 + 2 + 1 = 11
```

**Ответ:** `1011₂` = `11₁₀`

#### 8.3.4 Секрет chmod — откуда взялись 4, 2, 1?

Права доступа Linux основаны на **3-битной** двоичной системе:

```
Позиция бита:       2      1      0
                   ───    ───    ───
Двоичное значение: 2²     2¹     2⁰
                   ───    ───    ───
Десятичное:         4      2      1
                   ───    ───    ───
Тип права:          r      w      x
                  (read) (write) (execute)
```

**Это означает:**
- `r` (read) = бит 2 = **4**
- `w` (write) = бит 1 = **2**
- `x` (execute) = бит 0 = **1**

#### 8.3.5 Чтение прав через двоичную систему

Способ чтения вывода `ls -l`:

```
Где есть буква — ставим 1, где дефис — ставим 0:

-rwxrwxrwx  →  Преобразуем в двоичное
 │││ │││ │││
 111 111 111  →  Переводим каждую группу в десятичное
  7   7   7   →  chmod 777
```

**Подробные примеры:**

| Права | U (Owner) | G (Group) | O (Others) | chmod |
|-------|-----------|-----------|------------|-------|
| `rwxrwxrwx` | 111 = 7 | 111 = 7 | 111 = 7 | **777** |
| `rwxr-xr-x` | 111 = 7 | 101 = 5 | 101 = 5 | **755** |
| `rw-r--r--` | 110 = 6 | 100 = 4 | 100 = 4 | **644** |
| `rw-------` | 110 = 6 | 000 = 0 | 000 = 0 | **600** |
| `rwx------` | 111 = 7 | 000 = 0 | 000 = 0 | **700** |
| `r--------` | 100 = 4 | 000 = 0 | 000 = 0 | **400** |

#### 8.3.6 Полная таблица кодов chmod

| Двоичное | Десятичное | Права | Описание |
|----------|------------|-------|----------|
| `000` | 0 | `---` | Никаких прав |
| `001` | 1 | `--x` | Только выполнение |
| `010` | 2 | `-w-` | Только запись |
| `011` | 3 | `-wx` | Запись и выполнение |
| `100` | 4 | `r--` | Только чтение |
| `101` | 5 | `r-x` | Чтение и выполнение |
| `110` | 6 | `rw-` | Чтение и запись |
| `111` | 7 | `rwx` | Все права |

#### 8.3.7 Практические примеры

```bash
# Пример 1: chmod 755 script.sh
# Owner: rwx (111 = 7), Group: r-x (101 = 5), Others: r-x (101 = 5)
# Результат: -rwxr-xr-x

# Пример 2: chmod 644 document.txt
# Owner: rw- (110 = 6), Group: r-- (100 = 4), Others: r-- (100 = 4)
# Результат: -rw-r--r--

# Пример 3: chmod 700 private_dir
# Owner: rwx (111 = 7), Group: --- (000 = 0), Others: --- (000 = 0)
# Результат: drwx------

# Пример 4: chmod 600 secret.key
# Owner: rw- (110 = 6), Group: --- (000 = 0), Others: --- (000 = 0)
# Результат: -rw-------
```

> 🔐 **Совет по безопасности:** Никогда не используйте `777`! Это даёт полные права всем и опасно!

---

### 8.4 Числовые (octal) права — итоги

Каждое право соответствует двоичной позиции:
- `r` = 4 (в двоичном: `100`)
- `w` = 2 (в двоичном: `010`)
- `x` = 1 (в двоичном: `001`)

Они складываются:

| Права | Расчёт | Значение |
|-------|--------|----------|
| `rwx` | 4+2+1 | 7 |
| `rw-` | 4+2+0 | 6 |
| `r-x` | 4+0+1 | 5 |
| `r--` | 4+0+0 | 4 |
| `-wx` | 0+2+1 | 3 |
| `-w-` | 0+2+0 | 2 |
| `--x` | 0+0+1 | 1 |
| `---` | 0+0+0 | 0 |

**Распространённые комбинации:**

| Число | Права | Использование |
|-------|-------|---------------|
| 777 | rwxrwxrwx | Всем всё (опасно!) |
| 755 | rwxr-xr-x | Программы, скрипты |
| 700 | rwx------ | Личный каталог |
| 644 | rw-r--r-- | Обычные файлы |
| 600 | rw------- | Секретные файлы |
| 400 | r-------- | Только чтение |

### 8.5 chmod — изменение прав

**Числовой способ:**
```bash
chmod 755 script.sh                        # rwxr-xr-x
chmod 644 file.txt                         # rw-r--r--
chmod 600 secret.key                       # rw-------
```

**Символический способ:**
```bash
chmod u+x script.sh                        # Добавить execute для owner
chmod g-w file.txt                         # Убрать write у group
chmod o=r file.txt                         # Others только read
chmod a+r file.txt                         # Добавить read для всех
```

### 8.6 SUID, SGID, sticky bit

Специальные права:

#### SUID (set user ID) — 4xxx

Файл с SUID выполняется с правами владельца:

```bash
ls -la /usr/bin/passwd
# -rwsr-xr-x 1 root root ... /usr/bin/passwd
#    ^
#    SUID bit (буква s вместо x)
```

**Поиск SUID файлов:**
```bash
find / -perm -4000 2>/dev/null
```

#### SGID (set group ID) — 2xxx

Выполнение с правами группы:

```bash
find / -perm -2000 2>/dev/null
```

#### Sticky bit — 1xxx

В каталоге только владелец файла может его удалить:

```bash
ls -la /tmp
# drwxrwxrwt 10 root root ... /tmp
#          ^
#          Sticky bit (буква t)
```

---

## 9. Важные каталоги и их функции

### 9.1 /etc — конфигурационные файлы

```bash
/etc/passwd                                # Список пользователей
/etc/shadow                                # Хэши паролей (нужен root)
/etc/group                                 # Группы
/etc/sudoers                               # Права sudo
/etc/hosts                                 # IP-hostname маппинги
/etc/crontab                               # Запланированные задачи
```

### 9.2 /home — каталоги пользователей

```bash
/home/username/                            # Домашний каталог
/home/username/.bashrc                     # Конфигурация Bash
/home/username/.bash_history               # История команд
/home/username/.ssh/                       # SSH ключи
```

> **CTF совет:** В `.bash_history` может быть важная информация!

### 9.3 /var — переменные данные

```bash
/var/log/                                  # Log файлы
/var/log/syslog                            # Системные логи
/var/log/auth.log                          # Логи аутентификации
/var/www/html/                             # Файлы web сервера
/var/backups/                              # Резервные копии
```

### 9.4 /tmp — временные файлы

Каталог, в который могут писать все пользователи:

```bash
ls -la /tmp/
ls -la /tmp/.*                             # Скрытые файлы
```

### 9.5 /proc — виртуальная файловая система

Информация о процессах:

```bash
/proc/[PID]/                               # Каталог для каждого процесса
/proc/[PID]/cmdline                        # Команда процесса
/proc/[PID]/environ                        # Environment variables
/proc/version                              # Версия ядра
```

**Важно для CTF:**
```bash
strings /proc/*/environ 2>/dev/null | grep -i flag
strings /proc/*/environ 2>/dev/null | grep -i password
```

---

## 10. Работа с архивами

### 10.1 tar — tape archive

**Создание архива:**
```bash
tar -cvf archive.tar files/                # Обычный архив
tar -czvf archive.tar.gz files/            # Сжатие с Gzip
tar -cjvf archive.tar.bz2 files/           # Сжатие с Bzip2
tar -cJvf archive.tar.xz files/            # Сжатие с XZ
```

**Распаковка архива:**
```bash
tar -xvf archive.tar                       # Обычная распаковка
tar -xzvf archive.tar.gz                   # Распаковка Gzip
tar -xjvf archive.tar.bz2                  # Распаковка Bzip2
tar -xJvf archive.tar.xz                   # Распаковка XZ
tar -xvf archive.tar -C /destination/      # В определённое место
```

**Просмотр содержимого:**
```bash
tar -tvf archive.tar                       # Показать список
```

### 10.2 zip / unzip

```bash
zip archive.zip file1 file2                # Создать Zip
zip -r archive.zip directory/              # Рекурсивно
unzip archive.zip                          # Распаковать
unzip -l archive.zip                       # Показать список
```

### 10.3 gzip / gunzip

```bash
gzip file.txt                              # Создаёт file.txt.gz
gunzip file.txt.gz                         # Распаковывает
zcat file.txt.gz                           # Чтение без распаковки
```

---

## 11. Операции с дисками и монтирование

### 11.1 df — disk free

```bash
df                                         # Свободное место
df -h                                      # Human-readable
df -T                                      # Тип файловой системы
```

### 11.2 du — disk usage

```bash
du file.txt                                # Размер файла
du -h file.txt                             # Human-readable
du -sh directory/                          # Общий размер каталога
du -sh *                                   # Каждый элемент
du -ah . | sort -rh | head -20             # Топ 20 самых больших
```

### 9.3 lsblk — block devices

```bash
lsblk                                      # Блочные устройства
lsblk -f                                   # Информация о filesystem
```

### 9.4 mount

```bash
mount                                      # Все монтирования
mount /dev/sdb1 /mnt/usb                   # Смонтировать USB
umount /mnt/usb                            # Размонтировать
```

---

## 10. Символические ссылки

### 10.1 Hard link vs symbolic link

| Свойство | Hard Link | Symbolic Link |
|----------|-----------|---------------|
| Inode | Одинаковый | Новый |
| Файл удалён | Работает | Ломается |
| На каталог | Нельзя | Можно |
| Другая filesystem | Нельзя | Можно |

### 10.2 Создание symlink

```bash
ln -s /path/to/target linkname             # Создать symlink
ln -s /etc/passwd ~/passwd_link            # Пример
```

### 10.3 Просмотр symlinks

```bash
ls -la                                     # Начинается с l
readlink linkname                          # Показать target
readlink -f linkname                       # Полный путь
```

### 10.4 Поиск symlinks

```bash
find / -type l 2>/dev/null                 # Все symlinks
find / -xtype l 2>/dev/null                # Сломанные symlinks
```

---

## 11. Практические упражнения

### Упражнение 1: Базовая навигация

**Задача:** Выполните следующие операции:

1. Определите текущий каталог
2. Перейдите в домашний каталог
3. Перейдите в `/etc` и найдите файл `passwd`
4. Вернитесь в предыдущий каталог

**Решение:**
```bash
pwd
cd ~
cd /etc && ls -la | grep passwd
cd -
```

### Упражнение 2: Поиск файлов

**Задача:** Найдите следующие файлы:

1. Все `.txt` файлы в системе
2. Скрытые файлы в `/home`
3. Файлы больше 1MB в `/var`

**Решение:**
```bash
find / -name "*.txt" 2>/dev/null
find /home -name ".*" -type f 2>/dev/null
find /var -size +1M -type f 2>/dev/null
```

### Упражнение 3: Анализ прав

**Задача:** Объясните следующие права:

1. `-rw-r--r--` → 644 — Owner: чтение+запись, Group/Others: только чтение
2. `-rwxr-xr-x` → 755 — Owner: всё, Group/Others: чтение+выполнение
3. `drwxr-x---` → 750 — Каталог, Owner: всё, Group: чтение+выполнение, Others: нет доступа
4. `-rwsr-xr-x` → 4755 — SUID установлен

---

## 12. CTF стратегии

### 12.1 Первые шаги (60 секунд)

Первые действия в каждом CTF:

```bash
# 1. Кто я и где?
id && pwd && whoami

# 2. Что вокруг?
ls -la
tree -L 2 2>/dev/null

# 3. Быстрый поиск флага
find / -name "*flag*" 2>/dev/null
cat /home/*/flag* /root/flag* 2>/dev/null
```

### 12.2 Глубокая проверка (2-5 минут)

```bash
# Проверить историю Bash
cat /home/*/.bash_history 2>/dev/null

# Проверить SUID файлы
find / -perm -4000 2>/dev/null

# Проверить бэкапы
ls -la /var/backups/

# Проверить environment variables
cat /proc/*/environ 2>/dev/null | tr '\0' '\n' | grep -iE "(flag|pass|secret)"

# World-writable файлы
find / -writable -type f 2>/dev/null | head -20
```

### 12.3 Regex для формата флага

```bash
# Поиск различных форматов флага
grep -rE "FLAG\{[^}]+\}" / 2>/dev/null
grep -rE "CTF\{[^}]+\}" / 2>/dev/null
grep -rE "HTB\{[^}]+\}" / 2>/dev/null
grep -rE "flag\{[^}]+\}" / 2>/dev/null

# Общий паттерн
grep -roE "[A-Z]{2,10}\{[a-zA-Z0-9_-]+\}" / 2>/dev/null
```

### 12.4 Проверка бинарных файлов

```bash
# Поиск флага с помощью strings
strings suspicious_file | grep -iE "flag|password|secret"

# Из executable файлов
find / -type f -executable 2>/dev/null | xargs strings 2>/dev/null | grep FLAG

# Определение типа файла
file mystery_file
```

### 12.5 Важнейшие one-liners

```bash
# Ultimate flag hunter
grep -rE "(FLAG|CTF|HTB|flag)\{[^}]+\}" / 2>/dev/null

# SUID файлы для privilege escalation
find / -perm -4000 -type f -exec ls -la {} \; 2>/dev/null

# Файлы, которые вам не принадлежат, но вы можете читать
find / ! -user $(whoami) -readable -type f 2>/dev/null | head -20

# Файлы, изменённые за последние 30 минут
find / -mmin -30 -type f 2>/dev/null

# Поиск password
grep -rn "password" /home /etc /opt /var 2>/dev/null | head -20
```

### 12.6 Избегание ошибок

**Ошибки новичков:**

1. Не использовать `2>/dev/null` — вывод заполняется сообщениями об ошибках
2. Использовать `ls` вместо `ls -la` — скрытые файлы не видны
3. Забывать команду `strings` — флаги в бинарных файлах не находятся
4. Проверять только `/home` — `/opt`, `/var`, `/tmp` тоже важны
5. Игнорировать `.bash_history`

---

## Заключение

В этом руководстве рассмотрены основные концепции файловой системы Linux, команды и стратегии подготовки к CTF соревнованиям. Главный совет — **практика**. Ежедневно тренируйтесь на виртуальных машинах и CTF платформах.

**Запомните:**
- Всегда используйте `ls -la`
- `2>/dev/null` очищает вывод
- `strings` необходим для бинарных файлов
- В `.bash_history` может быть ценная информация
- SUID файлы важны для privilege escalation

Удачи!

---

**Дополнительные ресурсы:**

- [Linux Journey](https://linuxjourney.com/)
- [OverTheWire: Bandit](https://overthewire.org/wargames/bandit/)
- [TryHackMe](https://tryhackme.com/)
- [HackTheBox](https://www.hackthebox.com/)
- [picoCTF](https://picoctf.org/)

---

*Это руководство подготовлено Nodir Ustoz. По вопросам и предложениям обращайтесь к автору.*
